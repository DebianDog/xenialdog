#!/bin/bash

#pidrox="`ps -eo pid,cmd | grep -v grep | grep "rox -p ${HOME}/.config/rox.sourceforge.net/ROX-Filer/pinbd-OB" | awk '{ print $1 }'`"
#if [ "$pidrox" ]; then
#WALLPAPER=$(cat /root/.wallpapers/wallpapers.lst | grep "Scale \|Stretch \|Center \|Tile " | head -n1 | awk '{ print $3 }')
BACKDROP=$(grep 'backdrop style' $HOME/.config/rox.sourceforge.net/ROX-Filer/pinbd-OB)
WALLPAPER=$(echo "$BACKDROP" | sed 's/.*">//;s#</backdrop>##')
SCALING=$(grep 'backdrop style' $HOME/.config/rox.sourceforge.net/ROX-Filer/pinbd-OB | grep -o 'Scaled\|Stretched\|Centred\|Tiled')
[ "$SCALING" = "Scaled" ] && OPTION="-full"
[ "$SCALING" = "Stretched" ] && OPTION="-fill"
[ "$SCALING" = "Centred" ] && OPTION="-center"
[ "$SCALING" = "Tiled" ] && OPTION="-tile"
															
hsetroot $OPTION "$WALLPAPER"

while true; do
BACKDROP=$(grep 'backdrop style' $HOME/.config/rox.sourceforge.net/ROX-Filer/pinbd-OB)
WALLPAPER=$(echo "$BACKDROP" | sed 's/.*">//;s#</backdrop>##')

if [[ "$OLDWALLPAPER" != "$WALLPAPER" ]] || [[ "$OLDSCALING" != "$SCALING" ]]; then
BACKDROP=$(grep 'backdrop style' $HOME/.config/rox.sourceforge.net/ROX-Filer/pinbd-OB)
WALLPAPER=$(echo "$BACKDROP" | sed 's/.*">//;s#</backdrop>##')
SCALING=$(grep 'backdrop style' $HOME/.config/rox.sourceforge.net/ROX-Filer/pinbd-OB | grep -o 'Scaled\|Stretched\|Centred\|Tiled')
[ "$SCALING" = "Scaled" ] && OPTION="-full"
[ "$SCALING" = "Stretched" ] && OPTION="-fill"
[ "$SCALING" = "Centred" ] && OPTION="-center"
[ "$SCALING" = "Tiled" ] && OPTION="-tile"

hsetroot $OPTION "$WALLPAPER"
fi

OLDWALLPAPER=$WALLPAPER
OLDSCALING=$SCALING
sleep 3
done
#else
#echo
#fi

